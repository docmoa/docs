# μ•μ „ν• RAG μ‹μ¤ν… κµ¬μ¶•: HashiCorp Vaultμ™€ Amazon Bedrock ν™μ©

## κ°μ”

AI κΈ°μ μ λ°μ „κ³Ό ν•¨κ» κΈ°μ—…λ“¤μ€ λ°μ΄ν„°λ¥Ό λ” λ‘λ‘ν•κ² ν™μ©ν•κΈ° μ„ν• λ‹¤μ–‘ν• μ‹λ„λ¥Ό ν•κ³  μμµλ‹λ‹¤. νΉν, `μƒμ„±ν• AI(GenAI)`μ™€ `λ€κ·λ¨ μ–Έμ–΄ λ¨λΈ(LLM)`μ€ λ°μ΄ν„° λ¶„μ„κ³Ό μ‚¬μ©μ κ²½ν—μ„ νμ‹ ν•κ³  μμµλ‹λ‹¤. ν•μ§€λ§, μ‚¬μ „μ— ν•™μµλ λ°μ΄ν„°λ§μ„ κΈ°λ°μΌλ΅ ν•λ” LLMμ€ μµμ‹  μ •λ³΄μ— λ€ν• μ ‘κ·Όμ΄ μ ν•μ μ΄λΌλ” ν•κ³„λ¥Ό κ°€μ§€κ³  μμµλ‹λ‹¤.

μ΄λ¬ν• ν•κ³„λ¥Ό ν•΄κ²°ν•λ” κΈ°μ μ΄ λ°”λ΅ `Retrieval-Augmented Generation (RAG)`μ…λ‹λ‹¤. RAGλ” λ¨λΈμ΄ μ™Έλ¶€ λ°μ΄ν„° μ†μ¤λ¥Ό κ²€μƒ‰ν•μ—¬ μµμ‹  μ •λ³΄λ¥Ό ν†µν•©ν• λ‹µλ³€μ„ μ κ³µν•  μ μκ² ν•©λ‹λ‹¤. κΈ°μ—…μ€ μ΄ κΈ°μ μ„ ν™μ©ν•΄ μμ²΄ μ§€μ‹ κΈ°λ°μ„ λ°”νƒ•μΌλ΅ μ‚¬μ©μμ—κ² μµμ‹  μ •λ³΄μ™€ λ§μ¶¤ν• μ‘λ‹µμ„ μ κ³µν•  μ μμµλ‹λ‹¤. κ·Έλ¬λ‚ RAG μ‹μ¤ν…μ€ κ°μΈμ •λ³΄(PII), λ―Όκ°μ •λ³΄, ν΄λΌμ°λ“ μκ²© μ¦λ… λ“± κΈ°μ—…μ μ¤‘μ”ν• λ°μ΄ν„°λ¥Ό μ²λ¦¬ν•κΈ° λ•λ¬Έμ— λ°μ΄ν„° λ³΄νΈμ™€ λ³΄μ•μ΄ ν•„μμ μ…λ‹λ‹¤.

HashiCorp Vaultλ” μ΄λ¬ν• RAG μ‹μ¤ν…μ„ μ•μ „ν•κ² λ³΄νΈν•λ” λ° μ¤‘μ”ν• μ—­ν• μ„ ν•©λ‹λ‹¤. Vaultμ κ°•λ ¥ν• `μ•”νΈν™” κΈ°λ¥(Transit, Tokenization, Masking, FPE λ“±)`μ€ λ°μ΄ν„°λ¥Ό μ•μ „ν•κ² μ•”νΈν™”ν•κ³ , κ·μ μ™€ μ»΄ν”λΌμ΄μ–Έμ¤λ¥Ό μ¶©μ΅±ν•  μ μλ„λ΅ μ§€μ›ν•©λ‹λ‹¤. 

![μ°Έκ³ : Vault Masking κΈ°λ¥μ„ ν™μ©ν• μ•μ „ν• λ°μ΄ν„° νμ΄ν”„λΌμΈ μμ‹](./image/rag.png)

λ³Έ ν¬μ¤ν…μ—μ„λ” AWS ν™κ²½μ—μ„ Amazon Bedrockκ³Ό ν•¨κ» RAGλ¥Ό κµ¬μ¶•ν•λ” λ°©μ•μ„ μ†κ°ν•λ©°, Vaultλ¥Ό ν†µν•΄ λ―Όκ°μ •λ³΄λ¥Ό μ•μ „ν•κ² λ³΄νΈν•λ” λ°©λ²•μ„ μ„¤λ…ν•©λ‹λ‹¤.

::: tip π’΅ κ°μ‚¬ν• λ¶„(Special Thanks)
λ³Έ κΈ€μ€ HashiCorpμ [David Wright](https://www.linkedin.com/in/david-wright-57336a4/)μ [GitHub μ €μ¥μ†](https://github.com/dawright22/aws-rag-terraform-deployment-demo) λ°λ¨ μ‹λ‚λ¦¬μ¤λ¥Ό λ¶„μ„ λ° μ°Έκ³ ν•μ—¬ μ‘μ„±λμ—μµλ‹λ‹¤.
:::

## λ„μ…λ¶€: AIμ™€ LLM, κ·Έλ¦¬κ³  GenAI

### AI κΈ°μ μ λ°μ „κ³Ό LLMμ λ“±μ¥
μµκ·Ό AIλ” κΈ°μ—…μ λ°μ΄ν„° ν™μ© λ°©μ‹μ— μ¤‘μ”ν• λ³€ν™”λ¥Ό κ°€μ Έμ¤κ³  μμµλ‹λ‹¤. νΉν, λ€κ·λ¨ μ–Έμ–΄ λ¨λΈ(LLM)μ€ μ‚¬μ©μμ μ…λ ¥μ„ μ΄ν•΄ν•κ³ , μλ―Έ μλ” μ‘λ‹µμ„ μƒμ„±ν•  μ μμ–΄ λ‹¤μ–‘ν• μ‘μ© μ‚¬λ΅€λ¥Ό λ§λ“¤μ–΄λ‚΄κ³  μμµλ‹λ‹¤. μ΄ μ¤‘μ—μ„λ„ μƒμ„±ν• AI(GenAI)λ” κΈ°μ—…μ΄ λ°μ΄ν„°λ¥Ό ν™μ©ν•΄ μƒλ΅μ΄ κ°€μΉλ¥Ό μ°½μ¶ν•  μ μλ” κ°•λ ¥ν• λ„κµ¬λ΅ μλ¦¬ μ΅μ•μµλ‹λ‹¤.

### RAGμ ν•„μ”μ„±
κΈ°μ΅΄ LLMμ€ μ‚¬μ „μ— ν•™μµλ λ°μ΄ν„°λ§μ„ κΈ°λ°μΌλ΅ λ™μ‘ν•λ©°, ν•™μµ μ΄ν›„ μƒμ„±λ μµμ‹  λ°μ΄ν„°μ—λ” μ ‘κ·Όν•  μ μ—†μµλ‹λ‹¤. μ΄ ν•κ³„λ¥Ό κ·Ήλ³µν•κΈ° μ„ν•΄ λ“±μ¥ν• κΈ°μ μ΄ λ°”λ΅ **Retrieval-Augmented Generation (RAG)** μ…λ‹λ‹¤.

#### RAGμ μ£Όμ” νΉμ§•:
1. **μ™Έλ¶€ λ°μ΄ν„° κ²€μƒ‰**:
   - λ¬Έμ„, λ°μ΄ν„°λ² μ΄μ¤, API λ“± μ™Έλ¶€ μ†μ¤μ—μ„ μµμ‹  λ°μ΄ν„°λ¥Ό κ²€μƒ‰ν•μ—¬ λ¨λΈμ— ν†µν•©.
2. **μ μ—°ν• λ°μ΄ν„° μ—…λ°μ΄νΈ**:
   - κΈ°μ΅΄ λ¨λΈμ„ μ¬ν•™μµν•μ§€ μ•κ³ λ„ μƒλ΅μ΄ λ°μ΄ν„°λ¥Ό μ‰½κ² λ°μ.

#### RAG vs. νμΈνλ‹:
- **λΉ„μ© ν¨μ¨μ„±**: λ³„λ„μ λ¨λΈ μ¬ν•™μµ κ³Όμ •μ΄ ν•„μ”ν•μ§€ μ•μ•„ λΉ„μ©κ³Ό μ‹κ°„μ΄ μ μ•½.
- **μ μ—°μ„±**: μ™Έλ¶€ λ°μ΄ν„° μ†μ¤λ¥Ό λ³€κ²½ν•¨μΌλ΅μ¨ λ‹¤μ–‘ν• μ§λ¬Έμ— λ€μ‘ κ°€λ¥.

![RAG vs νμΈνλ‹(μ¶μ²: μ¤μΌν„°λ©μ¤)](./image/rag-finetuning.png)

## HashiCorp Vaultλ¥Ό ν™μ©ν• RAG μ‹μ¤ν… λ³΄νΈ

RAG μ‹μ¤ν…μ€ μ™Έλ¶€ λ°μ΄ν„°λ¥Ό κ²€μƒ‰ν•κ³  μ΄λ¥Ό μ²λ¦¬ν•λ” κ³Όμ •μ—μ„ **λ―Όκ°μ •λ³΄(PII, μ‹ν¬λ¦Ώ, κΈ°λ°€ λ°μ΄ν„°)** λ¥Ό ν¬ν•¨ν•  κ°€λ¥μ„±μ΄ ν½λ‹λ‹¤. μ΄λ¬ν• λ°μ΄ν„°λ¥Ό μ•μ „ν•κ² κ΄€λ¦¬ν•μ§€ μ•μΌλ©΄ λ°μ΄ν„° μ μ¶, κ·μ  μ„λ°, κΈ°μ—… μ‹ λΆ° μ†μ‹¤λ΅ μ΄μ–΄μ§ μ μμµλ‹λ‹¤.

### μ™ RAG μ‹μ¤ν…μ΄ μ•μ „ν•κ² κ΄€λ¦¬λμ–΄μ•Ό ν•λ”κ°€?
#### 1) **μ»΄ν”λΌμ΄μ–Έμ¤μ™€ κ·μ  μ¤€μ**
- **GDPR, CCPA, HIPAA** μ™€ κ°™μ€ κΈ€λ΅λ² λ°μ΄ν„° λ³΄νΈ κ·μ •μ€ κ°μΈμ •λ³΄μ™€ λ―Όκ°μ •λ³΄λ¥Ό μ•μ „ν•κ² κ΄€λ¦¬ν•  κ²ƒμ„ μ”κµ¬ν•©λ‹λ‹¤.
- Vaultλ¥Ό μ‚¬μ©ν•λ©΄ μ΄λ¬ν• κ·μ •μ„ μ¶©μ΅±ν•κΈ° μ„ν•΄ ν•„μ”ν• μ•”νΈν™”, μ•΅μ„Έμ¤ μ μ–΄, λ΅κ·Έ κΈ°λ΅ λ“±μ„ ν¨κ³Όμ μΌλ΅ κµ¬ν„ν•  μ μμµλ‹λ‹¤.

#### 2) **κ±°λ²„λ„μ¤μ™€ λ³΄μ• κ°•ν™”**
- κΈ°μ—…μ€ λ°μ΄ν„°λ¥Ό μ¤‘μ•™μ—μ„ κ΄€λ¦¬ν•λ©°, λ„κ°€ μ–΄λ–¤ λ°μ΄ν„°λ¥Ό μ‚¬μ©ν•λ”μ§€ λ…ν™•ν μ¶”μ ν•΄μ•Ό ν•©λ‹λ‹¤.
- Vaultλ” μ•”νΈν™” ν‚¤ κ΄€λ¦¬μ™€ λ™μ  μκ²© μ¦λ… μ κ³µμΌλ΅ λ°μ΄ν„° κ±°λ²„λ„μ¤λ¥Ό κ°•ν™”ν•©λ‹λ‹¤.

#### 3) **λ°μ΄ν„° μ μ¶ λ°©μ§€**
- λ¬Έμ„ λ°μ΄ν„°λ‚ κ²€μƒ‰ κ²°κ³Όκ°€ μ™Έλ¶€λ΅ μ μ¶λ  κ²½μ°, μ•”νΈν™”λ λ°μ΄ν„°λ” μ•μ „μ„±μ„ μ μ§€ν•©λ‹λ‹¤.

### Vaultμ μ£Όμ” μ•”νΈν™” κΈ°λ¥

HashiCorp Vaultλ” RAG μ‹μ¤ν…μ—μ„ λ°μƒν•λ” λ³΄μ• λ¬Έμ λ¥Ό ν•΄κ²°ν•κΈ° μ„ν•΄ λ‹¤μ–‘ν• μ•”νΈν™” κΈ°λ¥μ„ μ κ³µν•©λ‹λ‹¤:

#### 1) Transit μ•”νΈν™”
- νΉμ§•: λ°μ΄ν„°λ² μ΄μ¤λ‚ νμΌ μ‹μ¤ν…μ— μ €μ¥λλ” λ°μ΄ν„°λ¥Ό μ‹¤μ‹κ°„μΌλ΅ μ•”νΈν™” λ° λ³µνΈν™”.
- μ„¤λ…: Vaultμ Transit μ—”μ§„μ€ λ°μ΄ν„°λ¥Ό μ €μ¥ν•κΈ° μ „μ— μ•”νΈν™”ν•κ³ , μ½μ–΄μ¬ λ• λ³µνΈν™”ν•μ—¬ λ―Όκ° λ°μ΄ν„°κ°€ μ•”νΈν™”λ μƒνƒλ΅λ§ μ €μ¥λλ„λ΅ λ³΄μ¥ν•©λ‹λ‹¤. μ €μ¥λ λ°μ΄ν„°λ” Vault ν‚¤λ¥Ό μ‚¬μ©ν•΄ λ³΄νΈλλ©°, λ°μ΄ν„°λ² μ΄μ¤μ™€ νμΌ μ‹μ¤ν…μ μ§μ ‘ μ•”νΈν™” μ”κµ¬λ¥Ό μ¶©μ΅±ν•©λ‹λ‹¤.


#### 2) ν•μ‹ λ³΄μ΅΄ μ•”νΈν™” (FPE, Format-Preserving Encryption)
- νΉμ§•: λ°μ΄ν„°μ μ›λ ν•μ‹μ„ μ μ§€ν•λ©΄μ„ μ•”νΈν™”ν•μ—¬ λ°μ΄ν„° λ¶„μ„ λ° μ²λ¦¬ μ‹μ—λ„ ν™μ© κ°€λ¥.
- μ„¤λ…: μλ¥Ό λ“¤μ–΄, μ‹ μ©μΉ΄λ“ λ²νΈ `1234-5678-9101-1121`μ„ `9834-2647-8101-7532`μ™€ κ°™μ΄ ν•μ‹μ„ μ μ§€ν• μƒνƒλ΅ μ•”νΈν™”ν•©λ‹λ‹¤. Vaultμ Transform μ—”μ§„μ„ ν†µν•΄ μ μ©λλ©°, λ°μ΄ν„° λ¶„μ„ λ° μ²λ¦¬κ°€ ν•„μ”ν• ν™κ²½μ—μ„ νΉν μ μ©ν•©λ‹λ‹¤.


#### 3) λ°μ΄ν„° λ§μ¤ν‚Ή (Masking)
- νΉμ§•: λ°μ΄ν„° μ΅°ν μ‹ λ―Όκ°ν• μ •λ³΄λ¥Ό μ κ±°ν•κ±°λ‚ λ€μ²΄ν•μ—¬ μ ‘κ·Ό κ¶ν•μ΄ μ—†λ” μ‚¬μ©μμ λ°μ΄ν„° λ…Έμ¶μ„ μµμ†ν™”.
- μ„¤λ…: Vaultλ” λ°μ΄ν„°λ¥Ό μ½μ„ λ• νΉμ • ν•„λ“λ¥Ό λ§μ¤ν‚Ή μ²λ¦¬ν•μ—¬ λ―Όκ° μ •λ³΄μ κ°€μ‹μ„±μ„ μ ν•ν•©λ‹λ‹¤. μλ¥Όλ“¤μ–΄ μ‹ μ©μΉ΄λ“ λ²νΈλ¥Ό `****-****-****-1234` ν•μ‹μΌλ΅ λ§μ¤ν‚Ή μ²λ¦¬ν•  μ μμµλ‹λ‹¤.


#### 4) μ¤ν† λ¦¬μ§€ λ λ²¨ μ•”νΈν™” (TDE, Transparent Data Encryption)
- νΉμ§•: λ°μ΄ν„°κ°€ μ €μ¥λ  λ• λ°μ΄ν„°λ² μ΄μ¤λ‚ μ¤ν† λ¦¬μ§€ κ³„μΈµμ—μ„ μ•”νΈν™”λ¥Ό μν–‰.
- μ„¤λ…: `Oracle TDE`λ‚ `MSSQL TDE`μ™€ κ°™μ€ λ°μ΄ν„°λ² μ΄μ¤ μμ²΄μ μ•”νΈν™” κΈ°λ¥κ³Ό Vaultλ¥Ό ν†µν•©ν•μ—¬, μ €μ¥μ† λ λ²¨μ—μ„ λ°μ΄ν„°λ¥Ό μ•”νΈν™” λ° λ³΄νΈν•©λ‹λ‹¤. λ°μ΄ν„°κ°€ μ§μ ‘μ μΌλ΅ μ μ¶λλ”λΌλ„ λ³µνΈν™” ν‚¤ μ—†μ΄λ” μ½μ„ μ μ—†μµλ‹λ‹¤.

![μ°Έκ³ : Vaultμ„ ν™μ©ν• μ•”νΈν™” λ°©μ• ν†µν•© μ•„ν‚¤ν…μ²](./image/encryption_architecture.png)

## Vaultμ λ„μ… ν¨κ³Ό
Vaultλ¥Ό ν™μ©ν•λ©΄ λ‹¤μκ³Ό κ°™μ€ ν¨κ³Όλ¥Ό μ–»μ„ μ μμµλ‹λ‹¤:
1. **μ»΄ν”λΌμ΄μ–Έμ¤ μ¤€μ**:
   - GDPR, HIPAA λ“± κ·μ λ¥Ό μ¶©μ΅±ν•λ©°, κ°μ‚¬ λ° λ³΄κ³ λ¥Ό μ§€μ›.
2. **λ°μ΄ν„° μ μ¶ λ°©μ§€**:
   - μ•”νΈν™”λ λ°μ΄ν„°λ” μ μ¶λλ”λΌλ„ μ•μ „μ„±μ„ μ μ§€.
3. **μ¤‘μ•™ μ§‘μ¤‘ κ΄€λ¦¬**:
   - μ•”νΈν™” ν‚¤μ™€ λ°μ΄ν„°λ¥Ό μ¤‘μ•™μ—μ„ κ΄€λ¦¬ν•μ—¬ λ°μ΄ν„° κ±°λ²„λ„μ¤λ¥Ό κ°•ν™”.

## κµ¬ν„ λ°©μ•: GitHub Terraform μ½”λ“μ™€ μƒν” μ½”λ“ ν™μ©

::: tip Terraform μ½”λ“μ™€ μƒν” μ½”λ“
Vaultμ™€ RAGλ¥Ό ν†µν•©ν• μƒμ„Έν• κµ¬ν„ λ°©λ²•μ€ GitHubμ— μ—…λ΅λ“λ [Terraform μ½”λ“μ™€ μƒν” μ½”λ“](https://github.com/hyungwook0221/aws-rag-terraform-deployment-demo)λ¥Ό μ°Έκ³ ν•μ„Έμ”.
:::

κµ¬ν„ κΈ°μ :
- **FAISS**: λ¬Έμ„ λ²΅ν„°ν™” λ° κ²€μƒ‰.
- **LangChain**: λ°μ΄ν„° κ²€μƒ‰κ³Ό LLM ν†µν•©.
- **Streamlit**: μ‚¬μ©μ μΈν„°νμ΄μ¤ κµ¬μ„±.
- **Amazon Bedrock**: LLMμ„ ν†µν• μ‘λ‹µ μƒμ„±.
- **HashiCorp Vault**: λ°μ΄ν„° μ•”νΈν™” κΈ°λ¥ μ κ³µ.

![μ‚¬μ§„: μ£Όμ” μ»΄ν¬λ„νΈ λ΅κ³ ](./image/component.png)

## μ£Όμ” λ™μ‘ ν”„λ΅μ„Έμ¤
```mermaid
graph TD
    μ‹μ‘["μ‹μ‘"] --> λ¬Έμ„μ—…λ΅λ“["μ§€μ‹ λ² μ΄μ¤ λ¬Έμ„ μ—…λ΅λ“ (Streamlit)"]
    λ¬Έμ„μ—…λ΅λ“ --> λ―Όκ°μ •λ³΄μ•”νΈν™”["λ―Όκ° μ •λ³΄ μ•”νΈν™” (Vault Transit)"]
    λ―Όκ°μ •λ³΄μ•”νΈν™” --> λ²΅ν„°μƒμ„±["λ²΅ν„° μƒμ„± (FAISS)"]
    λ²΅ν„°μƒμ„± --> λ²΅ν„°μ €μ¥["λ²΅ν„° μ €μ¥ (FAISS)"]
    μ§λ¬Έμ…λ ¥["μ§λ¬Έ μ…λ ¥ (Streamlit)"] --> λ°μ΄ν„°κ²€μƒ‰["κ΄€λ ¨ λ°μ΄ν„° κ²€μƒ‰ (FAISS)"]
    λ°μ΄ν„°κ²€μƒ‰ --> λ°μ΄ν„°μ΅°ν["λ°μ΄ν„° μ΅°ν λ° LLM νΈμ¶ (LangChain)"]
    λ°μ΄ν„°μ΅°ν --> λ‹µλ³€μƒμ„±["λ‹µλ³€ μƒμ„± (AWS Bedrock)"]
    λ‹µλ³€μƒμ„± --> λ‹µλ³€μ¶λ ¥["λ‹µλ³€ μ¶λ ¥ (Streamlit)"]
    λ‹µλ³€μ¶λ ¥ --> λ["λ"]
```

::: tip π’΅ ν•Έμ¦μ¨ μ‹¤μµ 
κ°μΆ… κµ¬μ„±μ”μ†μ™€ λ™μ‘ λ°©μ‹μ— λ€ν• μ„¤λ…μ€ π‘‰ [μ—¬κΈ°](https://github.com/hyungwook0221/aws-rag-terraform-deployment-demo)μ—μ„ ν™•μΈν•μ‹¤ μ μμµλ‹λ‹¤.
:::